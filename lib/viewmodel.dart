import 'model.dart';

class FortuneViewModel {
  // 0ï½14 ã¾ã§ãƒãƒ¼ãƒ‰ 15 å€‹ï¼ˆè³ªå• 7 å€‹ + çµæœ 8 å€‹ï¼‰
  final List<Node?> node = List<Node?>.filled(15, null);

  int _currentIndex = 0;

  FortuneViewModel() {
    // ----- è³ªå•ãƒãƒ¼ãƒ‰ (0ã€œ6) -----
    // æ·±ã•1: æœ€åˆã®è³ªå•
    node[0] = QuestionNode("ã‚ãªãŸã¯è¡Œå‹•çš„ã§ã™ã‹ï¼Ÿ", 1, 2);
    
    // æ·±ã•2: 2ç•ªç›®ã®è³ªå•ï¼ˆYESã¨NOã§åˆ†å²ï¼‰
    node[1] = QuestionNode("åˆå¯¾é¢ã®äººã¨è©±ã™ã®ã¯å¾—æ„ã§ã™ã‹ï¼Ÿ", 3, 4);     // YESå´ã®åˆ†å²
    node[2] = QuestionNode("ä¸€äººã§éã”ã™æ™‚é–“ãŒå¥½ãã§ã™ã‹ï¼Ÿ", 5, 6);       // NOå´ã®åˆ†å²

    // æ·±ã•3: æœ€å¾Œã®è³ªå•ï¼ˆã•ã‚‰ã«åˆ†å²ï¼‰
    node[3] = QuestionNode("è¨ˆç”»ã‚’ç«‹ã¦ã¦ã‹ã‚‰å‹•ãã»ã†ã§ã™ã‹ï¼Ÿ", 7, 8);    // YESâ†’YESå´
    node[4] = QuestionNode("æ€ã„ã¤ã„ãŸã‚‰ã™ãè¡Œå‹•ã«ç§»ã—ã¾ã™ã‹ï¼Ÿ", 9, 10); // YESâ†’NOå´
    node[5] = QuestionNode("ã‚³ãƒ„ã‚³ãƒ„ã¨åŒã˜ä½œæ¥­ã‚’ç¶šã‘ã‚‰ã‚Œã¾ã™ã‹ï¼Ÿ", 11, 12); // NOâ†’YESå´
    node[6] = QuestionNode("æ°—åˆ†ã«ã‚ˆã£ã¦è¡Œå‹•ãŒå¤‰ã‚ã‚Šã‚„ã™ã„ã»ã†ã§ã™ã‹ï¼Ÿ", 13, 14); // NOâ†’NOå´

    // ----- çµæœãƒãƒ¼ãƒ‰ (7ã€œ14) -----
    node[7]  = ResultNode("ğŸ”¥", "ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚¿ã‚¤ãƒ—", "æƒ…ç†±çš„ã§ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã‚„ã™ã„ã‚¿ã‚¤ãƒ—ã§ã™ã€‚");
    node[8]  = ResultNode("ğŸ¯", "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ—", "æ€ã„åˆ‡ã‚Šã®è‰¯ã•ã§ãƒãƒ£ãƒ³ã‚¹ã‚’ã¤ã‹ã‚€ã‚¿ã‚¤ãƒ—ã§ã™ã€‚");
    node[9]  = ResultNode("ğŸ’¡", "ã‚¢ã‚¤ãƒ‡ã‚¢ã‚¿ã‚¤ãƒ—", "ã²ã‚‰ã‚ãã¨å¥½å¥‡å¿ƒãŒå¼·ã„ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ãªã‚¿ã‚¤ãƒ—ã§ã™ã€‚");
    node[10] = ResultNode("ğŸ¤", "ãƒãƒ©ãƒ³ã‚¹ã‚¿ã‚¤ãƒ—", "å‘¨ã‚Šã¨ã®èª¿å’Œã‚’å¤§äº‹ã«ã™ã‚‹å®‰å®šæ„Ÿã®ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚");
    node[11] = ResultNode("ğŸŒ±", "ãƒã‚¤ãƒšãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—", "è½ã¡ç€ã„ã¦ã„ã¦ç€å®Ÿã«å‰ã«é€²ã‚€åŠªåŠ›å®¶ã‚¿ã‚¤ãƒ—ã§ã™ã€‚");
    node[12] = ResultNode("ğŸ§±", "å®‰å®šã‚¿ã‚¤ãƒ—", "æ…é‡ã§å …å®Ÿã€å‘¨å›²ã‹ã‚‰ä¿¡é ¼ã•ã‚Œã‚‹ã‚¿ã‚¤ãƒ—ã§ã™ã€‚");
    node[13] = ResultNode("ğŸŒ™", "ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚¿ã‚¤ãƒ—", "æ„Ÿæ€§ãŒè±Šã‹ã§è¡¨ç¾ã™ã‚‹ã“ã¨ãŒå¾—æ„ãªã‚¿ã‚¤ãƒ—ã§ã™ã€‚");
    node[14] = ResultNode("â˜ï¸", "ãƒã‚¤ãƒ¯ãƒ¼ãƒ«ãƒ‰ã‚¿ã‚¤ãƒ—", "è‡ªåˆ†ã®ä¸–ç•Œè¦³ã‚’å¤§åˆ‡ã«ã™ã‚‹è‡ªç”±ãªã‚¿ã‚¤ãƒ—ã§ã™ã€‚");
  }

  Node get currentNode => node[_currentIndex] as Node;
  bool get isFinished => currentNode is ResultNode;

  void restart() => _currentIndex = 0;

  void answer(bool yes) {
    final q = currentNode as QuestionNode;
    _currentIndex = yes ? q.yes : q.no;
  }
}
